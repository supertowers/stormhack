class Vulnerability < ActiveRecord::Base
  mount_uploader :attachment, AttachmentUploader

  include AASM

  aasm column: 'status' do
    state :created, initial: true
    state :approved
    state :rejected
    state :published

    event :approve, after_commit: :increase_score do
      transitions from: :created, to: :approved
    end

    event :reject, after_commit: :decrease_score do
      transitions from: :created, to: :rejected
    end

    event :publish do
      transitions from: [:approved, :rejected], to: :published
    end
  end

  belongs_to :user
  belongs_to :site

  def increase_score
    user.increase_score
  end

  def decrease_score

  end
end
