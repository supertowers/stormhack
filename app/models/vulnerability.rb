class Vulnerability < ActiveRecord::Base

  include AASM

  aasm :column => 'status' do
    state :created, :initial => true
    state :approved
    state :rejected
    state :published

    event :approve, :after_commit => :increase_score do
      transitions :from => :created, :to => :approved
    end

    event :reject, :after_commit => :decrease_score do
      transitions :from => :created, :to => :rejected
    end

    event :publish do
      transitions :from => :approved, :to => :published
    end
  end

  belongs_to :user

  def increase_score
    user = User.find(self.user_id)
    user.increase_score
  end

  def decrease_score
    user = User.find(self.user_id)
    user.decrease_score
  end
end
